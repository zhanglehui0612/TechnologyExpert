## 一 Paxos协议是什么？有哪些角色?
📝 Paxos协议是一个分布式一致性协议，可以用于解决分布式场景下选主和数据一致性问题  

📌 Paxos 中的四大核心角色:  
✅ Client(客户端): 产生议题或者一个值，准备提交给提案者
✅ Proposer(提案者): 根据客户端的提出一个值或者提案，构建提案请求，产生提案编号，希望大家接受  
✅ Acceptor(决策者): 投票决定是否接受某个提案  
✅ Learner(学习者): 学习并记录被接受的值, 不参与投票  

**注意: 在实现中，一个节点往往同时扮演多个角色**  


## 二 Basic-Paxos 协议流程
📝 **Paxos协议流程主要分为2个阶段: 准备(Prepare) -> 接受(Accept) **  

### 2.1 准备(Prepare)阶段
#### 2.1.1 Proposer(提案者)
✅ 每一个提案者都可以进行提案  
✅ 提案者收到客户端的议题，构建提案请求，自增提案编号  
✅ 提案者将提案请求(Prepared)发送提交给决策者进行决策  
✅ 提案者如果收到半数以上决策者的响应，则开始进入第二阶段：接受阶段  

#### 2.1.2 Acceptor(决策者)
✅ 决策者收到提案者的请求，根据提案编号和自己维护的提案信息进行比较  
✅ 如果不存在，则添加提案信息，然后响应提案者，返回Promise响应  
✅ 如果存在，但是提案编号大于自己维护的，则响应提案者，返回Promise响应  
✅ 如果存在，但是提案编号小于自己维护的，则不会进行Promise响应  

### 2.2 接受(Accept)阶段
#### 2.2.1 Proposer(提案者)
✅ 提案者向决策发起接收提案的Accept请求，用于接受这个提案  
✅ 提案者收到半数以上的决策者的Accepted响应，则表示这个提案被接受  
✅ 然后会广播这个提案  

#### 2.2.2 Acceptor(决策者)
✅ 决策者收到提案者的请求，根据提案编号和自己维护的提案信息进行比较  
✅ 如果不存在，则添加提案信息，然后响应提案者，返回Accepted响应  
✅ 如果存在，但是提案编号大于自己维护的，则响应提案者，返回Accepted响应  
✅ 如果存在，但是提案编号小于自己维护的，则不会进行Accepted响应  


## 三 Multi-Paxos 协议流程

### 3.1 准备(Prepare)阶段
#### 3.1.1 Proposer Leader(提案者Leader)
✅ 不能每一个提案者都可以提案，而是要从提案者中选择一个Leader，专门负责构建提案请求，自增提案编号  
✅ 提案者Leader收到客户端的议题，构建提案请求，自增提案编号  
✅ 提案者Leader将提案请求(Prepared)发送提交给决策者进行决策  
✅ 提案者Leader如果收到半数以上决策者的响应，则开始进入第二阶段：接受阶段  

#### 3.1.2 Acceptor(决策者)
✅ 决策者收到提案者的请求，根据提案编号和自己维护的提案信息进行比较  
✅ 如果不存在，则添加提案信息，然后响应提案者，返回Promise响应  
✅ 如果存在，但是提案编号大于自己维护的，则响应提案者，返回Promise响应  
✅ 如果存在，但是提案编号小于自己维护的，则不会进行Promise响应  

### 3.2 接受(Accept)阶段
#### 3.2.1 Proposer Leader(提案者Leader)
✅ 提案者Leader向决策发起接收提案的Accept请求，用于接受这个提案  
✅ 提案者Leader收到半数以上的决策者的Accepted响应，则表示这个提案被接受  
✅ 提案者Leader广播这个提案  

#### 3.2.2 Acceptor(决策者)
✅ 决策者收到提案者的请求，根据提案编号和自己维护的提案信息进行比较  
✅ 如果不存在，则添加提案信息，然后响应提案者，返回Accepted响应  
✅ 如果存在，但是提案编号大于自己维护的，则响应提案者，返回Accepted响应  
✅ 如果存在，但是提案编号小于自己维护的，则不会进行Accepted响应  


## 四 Basic-Paxos 和 Multi-Paxos协议 比较
### 4.1  Basic Paxos存在什么问题?
✅ 多个提案者都要发起提案，影响性能，还可能造成活锁  

### 4.2 Multi-Paxos没有简化的版本
✅ 还是以前的架构和角色，但是不再是所有的提案者都可以进行提案了，而是会从提案者中选择一个Leader来进行提案  

### 4.3 Multi-Paxos简化后的版本
✅ 客户端、提案者、决策者、学习者四个角色，一个节点都可以充当，简化了成本  
✅ 提案者同样会选择一个Leader接收客户端的议题，然后发起提案请求  
✅ ZAB协议就是基于这个简化的版本   

